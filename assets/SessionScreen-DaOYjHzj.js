import{r,j as s}from"./index-Cuv1hYfA.js";import{u as z}from"./AuthenticatedApp-Cbk8xiRg.js";import"./firebaseAuth-DlN8ja1T.js";import"./firebaseStore-DfVX9XbF.js";const t={FLASH:"flash",READY:"ready",ANSWER:"answer",MATH_ANSWER:"math_answer",MEMORIZE:"memorize",SUMMARY:"summary"},O={chunk:"chunk",collocation:"collocation",sentence:"sentence"};function K({config:E,records:S,onComplete:k,onExit:u}){var A,M;const{flashTime:b,sets:o=[],subject:C="english",mathAnswerMode:p="none",sessionMode:N="timeattack"}=E||{},[i,T]=r.useState(0),[l,m]=r.useState(N==="memorize"?t.MEMORIZE:t.FLASH),[f,_]=r.useState([]),[H,R]=r.useState(!1),[L,Y]=r.useState(0),d=r.useRef(null),e=o[i],h=o.length,c=C==="math",w=((A=e==null?void 0:e.items)==null?void 0:A[0])||"",j=(e==null?void 0:e.answer)||(e==null?void 0:e.answer1)||((M=e==null?void 0:e.items)==null?void 0:M[1])||"";r.useEffect(()=>()=>clearTimeout(d.current),[]),r.useEffect(()=>{if(l!==t.SUMMARY){if(clearTimeout(d.current),N==="memorize"){m(t.MEMORIZE);return}$()}},[i,N]);const $=()=>{clearTimeout(d.current),m(t.FLASH),R(!0),Y(a=>a+1),d.current=setTimeout(()=>{R(!1),d.current=setTimeout(()=>m(t.READY),250)},Number(b)*1e3)},v=(a=N)=>{var y;if(!e)return;const n=S[e.id],x=((y=e==null?void 0:e.items)==null?void 0:y.length)||0,F=z(n,0,x,{mode:a}),W={wordSetId:e.id,correctCount:0,totalCount:x,record:F},D=[...f,W];if(_(D),i+1>=h){m(t.SUMMARY);return}T(U=>U+1)},I=()=>k(f),g=()=>{if(p==="showAnswer"&&j){clearTimeout(d.current),m(t.MATH_ANSWER),d.current=setTimeout(()=>v("timeattack"),1e3);return}v("timeattack")};return!e&&l!==t.SUMMARY?s.jsx("div",{className:"session-screen",children:s.jsxs("div",{className:"session-content summary-content",children:[s.jsx("div",{className:"summary-title",children:"„Çª„ÉÉ„Éà„Åå„ÅÇ„Çä„Åæ„Åõ„Çì"}),s.jsx("button",{className:"btn btn-primary btn-full",onClick:u,children:"„Éõ„Éº„É†„Å∏Êàª„Çã"})]})}):l===t.FLASH?s.jsxs("div",{className:"session-screen flash-screen",children:[s.jsx("div",{className:"countdown-bar-wrap",children:s.jsx("div",{className:"countdown-bar",style:{animationDuration:`${b}s`}},L)}),s.jsx("div",{className:`session-content flash-content ${H?"visible":"hidden"}`,children:s.jsx("div",{className:"flash-items",children:(c?[w]:e.items).filter(Boolean).map((a,n)=>s.jsx("div",{className:"flash-item",style:{animationDelay:`${n*.05}s`},children:a},n))})})]}):l===t.MEMORIZE?s.jsxs("div",{className:"session-screen",children:[s.jsxs("div",{className:"session-topbar",children:[s.jsx("button",{className:"exit-btn",onClick:u,children:"‰∏≠Êñ≠"}),s.jsx("div",{className:"round-indicator",children:o.map((a,n)=>s.jsx("div",{className:`round-dot ${n<i?"done":n===i?"current":""}`},n))})]}),s.jsxs("div",{className:"session-content answer-content anim-slide-up",children:[s.jsx("div",{className:"answer-list-title",children:"ÊöóË®ò„É¢„Éº„Éâ"}),s.jsx("div",{className:"answer-list",children:(c?[w]:e.items).filter(Boolean).map((a,n)=>s.jsx("div",{className:"answer-item",children:s.jsx("span",{className:"answer-text",children:a})},n))}),e.note&&s.jsxs("div",{className:"answer-note",children:["note: ",e.note]}),s.jsx("button",{className:"btn btn-primary btn-full",onClick:()=>v("memorize"),children:i+1>=h?"„Çª„ÉÉ„Ç∑„Éß„É≥ÁµÇ‰∫Ü":"Ê¨°„Å∏"})]})]}):l===t.READY?s.jsxs("div",{className:"session-screen",children:[s.jsxs("div",{className:"session-topbar",children:[s.jsx("button",{className:"exit-btn",onClick:u,children:"‰∏≠Êñ≠"}),s.jsx("div",{className:"round-indicator",children:o.map((a,n)=>s.jsx("div",{className:`round-dot ${n<i?"done":n===i?"current":""}`},n))})]}),s.jsxs("div",{className:"session-content recall-content anim-slide-up",children:[s.jsx("div",{className:"brain-icon",children:c?"üßÆ":"üß†"}),s.jsx("div",{className:"recall-question",children:c?"È†≠„ÅÆ‰∏≠„ÅßÁ≠î„Åà„ÇíÊÄù„ÅÑÂá∫„Åó„Å¶„Åè„Å†„Åï„ÅÑ":"ÂÜÖÂÆπ„ÇíÊÄù„ÅÑÂá∫„Åó„Å¶„Åè„Å†„Åï„ÅÑ"}),s.jsx("div",{className:"recall-sub",children:c?"Ê∫ñÂÇô„Åß„Åç„Åü„ÇâÊ¨°„Å∏":"Ê∫ñÂÇô„Åß„Åç„Åü„ÇâÁ≠î„ÅàË°®Á§∫„Å∏"}),c?s.jsx("button",{className:"btn btn-primary btn-full",onClick:g,children:p==="showAnswer"&&j?"Á≠î„Åà„ÇíË°®Á§∫Ôºà1ÁßíÔºâ":i+1>=h?"„Çª„ÉÉ„Ç∑„Éß„É≥ÁµÇ‰∫Ü„Å∏":"Ê¨°„ÅÆÂºè„Å∏"}):s.jsx("button",{className:"btn btn-primary btn-full",onClick:()=>m(t.ANSWER),children:"Á≠î„Åà„ÇíË°®Á§∫"})]})]}):l===t.MATH_ANSWER?s.jsxs("div",{className:"session-screen",children:[s.jsxs("div",{className:"session-topbar",children:[s.jsx("button",{className:"exit-btn",onClick:u,children:"‰∏≠Êñ≠"}),s.jsx("div",{className:"round-indicator",children:o.map((a,n)=>s.jsx("div",{className:`round-dot ${n<i?"done":n===i?"current":""}`},n))})]}),s.jsxs("div",{className:"session-content answer-content anim-slide-up",children:[s.jsx("div",{className:"answer-list-title",children:"Á≠î„Åà"}),s.jsx("div",{className:"answer-item",children:s.jsx("span",{className:"answer-text",children:j||"Á≠î„ÅàÊú™Ë®≠ÂÆö"})})]})]}):l===t.ANSWER?s.jsxs("div",{className:"session-screen",children:[s.jsxs("div",{className:"session-topbar",children:[s.jsx("button",{className:"exit-btn",onClick:u,children:"‰∏≠Êñ≠"}),s.jsx("div",{className:"round-indicator",children:o.map((a,n)=>s.jsx("div",{className:`round-dot ${n<i?"done":n===i?"current":""}`},n))})]}),s.jsxs("div",{className:"session-content answer-content anim-slide-up",children:[s.jsxs("div",{className:"answer-list",children:[s.jsx("div",{className:"answer-list-title",children:c?"Á≠î„Åà":"Á≠î„Åà„É™„Çπ„Éà"}),c?s.jsx("div",{className:"answer-item",children:s.jsx("span",{className:"answer-text",children:j||"Á≠î„ÅàÊú™Ë®≠ÂÆö"})}):e.items.map((a,n)=>s.jsx("div",{className:"answer-item",children:s.jsx("span",{className:"answer-text",children:a})},n))]}),e.note&&s.jsxs("div",{className:"answer-note",children:["note: ",e.note]}),s.jsx("button",{className:"btn btn-primary btn-full",onClick:()=>v("timeattack"),children:i+1>=h?"„Çª„ÉÉ„Ç∑„Éß„É≥ÁµÇ‰∫Ü":"Ê¨°„Å∏"})]})]}):l===t.SUMMARY?s.jsx("div",{className:"session-screen",children:s.jsxs("div",{className:"session-content summary-content anim-slide-up",children:[s.jsx("div",{className:"summary-title",children:"„Çª„ÉÉ„Ç∑„Éß„É≥ÂÆå‰∫Ü"}),s.jsxs("div",{className:"summary-pct",children:["ÂÖ® ",h," „Çª„ÉÉ„Éà„ÇíÂá¶ÁêÜ„Åó„Åæ„Åó„Åü"]}),s.jsx("div",{className:"summary-rounds",children:o.map((a,n)=>{var x;return s.jsxs("div",{className:"summary-round-item",children:[s.jsx("span",{className:`badge badge-${a.level}`,children:O[a.level]||a.level}),s.jsx("span",{className:"summary-round-items",children:c?((x=a.items)==null?void 0:x[0])||a.note||a.id:a.items.slice(0,2).join(", ")}),s.jsx("span",{className:"summary-round-pct",children:"ÂÆå‰∫Ü"})]},n)})}),s.jsx("button",{className:"btn btn-primary btn-full btn-lg",onClick:I,children:"„Éõ„Éº„É†„Å∏"})]})}):null}export{K as default};
